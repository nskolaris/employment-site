<style>	.inactivo{background-color: rgba(251, 199, 199, 1)!important;}</style><script>$(document).ready(function(){	$('#btn-filtros').click(function(){		$('#filtros-container').modal('show');	});		/* Tooltips */	$('#botonera button').tooltip({container: 'body'});	$('.acciones a').tooltip();});function Filtrar(){	$('#filtros').submit();}function LimpiarFiltros(){	$('#filtros').trigger("reset");	$("#filtros").find('input:text, input:password, input:file, select, textarea').val('');	Filtrar();}function VerUsuarios(id){	$.post('<?php echo $this->Html->Url(array('controller'=>'empresas','action'=>'get_usuarios_internos','control'=>false)); ?>/'+id,function(response){		if(response != 'error'){			var response_decoded = JSON.parse(response);			$('#usuarios-internos tbody').html('');			$.each(response_decoded,function(index, value){							var tr = '<tr>';				tr += '<td>'+value.UsuarioInterno.nombre+'</td>'				tr += '<td>'+value.UsuarioInterno.apellido+'</td>'				tr += '<td>'+value.UsuarioInterno.email+'</td>'				tr += '<td>'+value.UsuarioInterno.telefono+'</td>'				tr += '<td>'+value.Rol.denominacion+'</td>'				tr += '</tr>'								$('#usuarios-internos tbody').append(tr);			});			$('#users-container').modal('show');		}	});}function ToggleActive(id){	$.post('<?php echo $this->Html->Url(array('controller'=>'empresas','action'=>'control_toggle_active',)); ?>/'+id,function(response){		if(response != 'error'){			if(response == 'on'){				$('#empresa-'+id).removeClass('inactivo');			}else{				$('#empresa-'+id).addClass('inactivo');			}		}	});}</script><div class="col-md-12">	<h1 style="float: left; margin: 10px 0px;">Empresas</h1>		<div id="botonera" style="float: right; margin: 10px 0px;" class="btn-group botonera">		<button type="button" data-toggle="tooltip" data-placement="bottom" title="Todos" onClick="LimpiarFiltros();" class="btn btn-default glyphicon glyphicon-asterisk"></button>		<button type="button" data-toggle="tooltip" data-placement="bottom" title="Filtro avanzado" id="btn-filtros" class="btn btn-primary glyphicon glyphicon-search"></button>	</div>	<br><br><br>	<h5 id="n-resultados"><?php echo $this->Paginator->counter('Se encontraron {:count} resultados'); ?></h5>		<table class="table">			<thead>			<tr>				<th><?php echo $this->Paginator->sort('id', 'ID'); ?></th>				<th><?php echo $this->Paginator->sort('nombre_comercial', 'Nombre comercial'); ?></th>				<th><?php echo $this->Paginator->sort('razon_social', 'Razón social'); ?></th>				<th>Industria</th>				<th>Ubicación</th>				<th>Acciones</th>			</tr>		</thead>				<tbody>			<?php foreach($empresas as $empresa){ ?>				<tr id="empresa-<?php echo $empresa['Empresa']['id']; ?>" class="<?php echo($empresa['Empresa']['activa']=='0'?'inactivo':''); ?>">					<td><?php echo $empresa['Empresa']['id']; ?></td>					<td><?php echo $empresa['Empresa']['nombre_comercial']; ?></td>					<td><?php echo $empresa['Empresa']['razon_social']; ?></td>					<td><?php echo $empresa['LaboralIndustria']['denominacion']; ?></td>					<td><?php echo $empresa['Provincia']['denominacion'].', '.$empresa['Provincia']['Pais']['denominacion']; ?></td>					<td class="acciones">						<?php echo $this->Html->link('','javascript:void(0);',array('onClick'=>'VerUsuarios('.$empresa['Empresa']['id'].');','class'=>'glyphicon glyphicon-user','data-toggle'=>'tooltip','data-placement'=>'bottom','title'=>'Ver Usuarios')); ?>						<?php echo $this->Html->link('','javascript:void(0);',array('onClick'=>'ToggleActive('.$empresa['Empresa']['id'].');','class'=>'glyphicon glyphicon-ban-circle','data-toggle'=>'tooltip','data-placement'=>'bottom','title'=>'Activar/Desactivar')); ?>						<?php echo $this->Html->link('',array('controller'=>'productos','action'=>'control_compras',$empresa['Empresa']['id']),array('class'=>'glyphicon glyphicon-usd','data-toggle'=>'tooltip','data-placement'=>'bottom','title'=>'Compras')); ?>					</td>				</tr>			<?php } ?>		</tbody>			</table>		<?php echo $this->Paginator->numbers(); ?></div><!-- Filtros --><div class="modal fade" id="filtros-container" tabindex="-1" role="dialog" aria-labelledby="filtros-containerLabel" aria-hidden="true">  <div class="modal-dialog">    <div class="modal-content">      <div class="modal-header">        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Cerrar</span></button>        <h4 class="modal-title" id="filtros-containerLabel">Filtros</h4>      </div>		<div class="modal-body">			<form id="filtros" role="form" class="form-personal" style="padding: 0px;" action="<?php echo $this->here; ?>" method="post">				<h3>Datos de la Empresa</h3>				<div class="form-group">					<?php echo $this->Form->input("Empresa.nombre_comercial", array('class'=>'botonplano inputplano form-control','label' => 'Nombre comercial')); ?>					<?php echo $this->Form->input("Empresa.razon_social", array('class'=>'botonplano inputplano form-control','label' => 'Razón social')); ?>					<?php echo $this->Form->input("Empresa.industria_id", array('class'=>'botonplano inputplano form-control','label' => 'Industria', 'options' => $industrias, 'empty'=>'-- Todas las industrias --')); ?>				</div>			</form>		</div>		<div class="modal-footer">			<button type="button" class="btn btn-default" onClick="LimpiarFiltros();">Limpiar filtros</button>			<button type="button" class="btn btn-primary" onClick="Filtrar();">Filtrar</button>		</div>    </div>  </div></div><!-- Usuarios Internos --><div class="modal fade" id="users-container" tabindex="-1" role="dialog" aria-labelledby="users-containerLabel" aria-hidden="true">	<div class="modal-dialog">		<div class="modal-content">			<div class="modal-header">				<button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Cerrar</span></button>				<h4 class="modal-title" id="users-containerLabel">Usuarios</h4>			</div>			<div class="modal-body">				<table id="usuarios-internos" class="table table-hover">					<thead>						<tr>							<th>Nombre</th>							<th>Apellido</th>							<th>E-mail</th>							<th>Telefono</th>							<th>Rol</th>						</tr>					</thead>					<tbody></tbody>				</table>			</div>		</div>	</div></div>