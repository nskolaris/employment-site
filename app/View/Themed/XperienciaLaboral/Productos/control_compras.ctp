<style>	.activo{background-color: rgba(139, 233, 139, 1);}	.por_terminar{background-color: rgba(249, 237, 146, 1);}	.terminado{background-color: rgba(255, 167, 167, 1);}	.inactivo{}</style><?php 	echo $this->Html->css('datepicker');	echo $this->Html->script('bootstrap-datepicker');?><script>$(document).ready(function(){	$('#btn-filtros').click(function(){		$('#filtros-container').modal('show');	});		$('#btn-nuevac').click(function(){		$('#nuevac-container').modal('show');	});		/* Tooltips */	$('#botonera button').tooltip({container: 'body'});	$('.acciones a').tooltip();		$('.fecha-selector').datepicker({		format: "dd/mm/yyyy"	});});function Filtrar(){	$('#filtros').submit();}function LimpiarFiltros(filtrar){	$('#filtros').trigger("reset");	$("#filtros").find('input:text, input:password, input:file, select, textarea, input:hidden').val('');	if(filtrar){		Filtrar();	}}function Activate(id){	$.post('<?php echo $this->Html->Url(array('controller'=>'productos','action'=>'control_activar',)); ?>/'+id,function(response){		if(response != 'error'){			data = JSON.parse(response);			$('#compra-'+id+' .acciones .glyphicon').removeClass('glyphicon-ok');			$('#compra-'+id+' .acciones .glyphicon').addClass('glyphicon-remove');			$('#compra-'+id+' .acciones .glyphicon').attr('title','Desactivar');			$('#compra-'+id+' .acciones .glyphicon').attr('onClick','Deactivate('+id+')');			$('#compra-'+id+' .estado').html('Activo');			$('#compra-'+id+' .ffin').html(data.EmpresaProducto.ffin);			$('#compra-'+id).removeClass('inactivo');			$('#compra-'+id).addClass('activo');		}	});}function Deactivate(id){	$.post('<?php echo $this->Html->Url(array('controller'=>'productos','action'=>'control_desactivar',)); ?>/'+id,function(response){		if(response != 'error'){			$('#compra-'+id+' .acciones .glyphicon').addClass('glyphicon-ok');			$('#compra-'+id+' .acciones .glyphicon').removeClass('glyphicon-remove');			$('#compra-'+id+' .acciones .glyphicon').attr('title','Activar');			$('#compra-'+id+' .acciones .glyphicon').attr('onClick','Activate('+id+')');			$('#compra-'+id+' .acciones .glyphicon').attr('onClick','Activate('+id+')');			$('#compra-'+id+' .estado').html('Inactivo');			$('#compra-'+id).removeClass('activo');			$('#compra-'+id).addClass('inactivo');		}	});}function ToggleActivas(value){	LimpiarFiltros(false);	$('#EmpresaProductoActivo').val(value);	Filtrar();}function RegisterNewCompra(){	var empresa_id = $('#nuevac-empresa').val();	var producto_id = $('#nuevac-producto').val();	var importe = $('#nuevac-importe').val();	if(empresa_id != '' && producto_id != ''){		$.post('<?php echo $this->Html->Url(array('controller'=>'productos','action'=>'nueva_compra')); ?>',{empresa_id: empresa_id, producto_id: producto_id, importe: importe}, function(response){			if(response == 'ok'){				location.reload();			}		});	}}</script><div class="col-md-12">	<h1 style="float: left; margin: 10px 0px;">Compras</h1>		<div id="botonera" style="float: right; margin: 10px 0px;" class="btn-group botonera">		<button type="button" data-toggle="tooltip" data-placement="bottom" title="Todos" onClick="LimpiarFiltros(true);" class="btn btn-default glyphicon glyphicon-asterisk"></button>		<button type="button" data-toggle="tooltip" data-placement="bottom" title="Inactivas" onClick="ToggleActivas(0);" class="btn btn-default glyphicon glyphicon-remove"></button>		<button type="button" data-toggle="tooltip" data-placement="bottom" title="Activas" onClick="ToggleActivas(1);" class="btn btn-default glyphicon glyphicon-ok"></button>		<button type="button" data-toggle="tooltip" data-placement="bottom" title="Filtro avanzado" id="btn-filtros" class="btn btn-primary glyphicon glyphicon-search"></button>	</div>		<br><br><br><button type="button" class="btn btn-default" id="btn-nuevac">Nueva Compra</button>		<h5 id="n-resultados"><?php echo $this->Paginator->counter('Se encontraron {:count} resultados'); ?></h5>	<table class="table">			<thead>			<tr>				<th><?php echo $this->Paginator->sort('id', 'ID'); ?></th>				<th>Empresa (Nombre comercial)</th>				<th>Producto</th>				<th>Precio</th>				<th>Fecha de compra</th>				<th>Fecha de vencimiento</th>				<th>Avisos restantes</th>				<th>Estado</th>				<th>Acciones</th>			</tr>		</thead>				<tbody>			<?php foreach($empresa_productos as $empresa_producto){ ?>				<?php 								$avisos_restantes = (isset($empresa_producto['EmpresaProducto']['avisos_restantes'])?$empresa_producto['EmpresaProducto']['avisos_restantes']:0);				$dias_restantes = (isset($empresa_producto['EmpresaProducto']['dias_restantes'])?$empresa_producto['EmpresaProducto']['dias_restantes']:0);								if($empresa_producto['EmpresaProducto']['activo'] == 1){					if($avisos_restantes > 0 || $dias_restantes > 0){						if($avisos_restantes > 3 || $dias_restantes > 3){							$estado = 'Activo';							$class = 'activo';						}else{							$estado = 'Por terminar';							$class = 'por_terminar';						}					}else{						$estado = 'Terminado';						$class = 'terminado';					}				}else{					$estado = 'Inactivo';					$class = 'inactivo';				} 								?>				<tr id="compra-<?php echo $empresa_producto['EmpresaProducto']['id']; ?>" class="<?php echo $class; ?>">					<td><?php echo $empresa_producto['EmpresaProducto']['id']; ?></td>					<td><?php echo $empresa_producto['Empresa']['nombre_comercial']; ?></td>					<td><?php echo $empresa_producto['Producto']['denominacion']; ?></td>					<td><?php echo 'MX$'.$empresa_producto['EmpresaProducto']['importe']; ?></td>					<?php 						$date = new DateTime($empresa_producto['EmpresaProducto']['created']);						if($empresa_producto['EmpresaProducto']['ffin'] != null){							$date_ffin = new DateTime($empresa_producto['EmpresaProducto']['ffin']);							$empresa_producto['EmpresaProducto']['ffin'] = $date_ffin->format('d-m-Y');						}					?>					<td><?php echo $date->format('d-m-Y'); ?></td>										<td class="ffin"><?php echo (!empty($empresa_producto['EmpresaProducto']['ffin'])?$empresa_producto['EmpresaProducto']['ffin']:'-'); ?></td>					<td><?php echo (!empty($empresa_producto['EmpresaProducto']['avisos_restantes'])?$empresa_producto['EmpresaProducto']['avisos_restantes']:'-'); ?></td>					<td class="estado"><?php echo $estado; ?></td>					<td class="acciones">						<?php if($class=='inactivo'){ ?>							<?php echo $this->Html->link('','javascript:void(0);',array('onClick'=>'Activate('.$empresa_producto['EmpresaProducto']['id'].');','class'=>'glyphicon glyphicon-ok','data-toggle'=>'tooltip','data-placement'=>'bottom','title'=>'Activar')); ?>						<?php }elseif($class=='activo' || $class=='por_terminar'){ ?>							<?php echo $this->Html->link('','javascript:void(0);',array('onClick'=>'Deactivate('.$empresa_producto['EmpresaProducto']['id'].');','class'=>'glyphicon glyphicon-remove','data-toggle'=>'tooltip','data-placement'=>'bottom','title'=>'Desactivar')); ?>						<?php } ?>					</td>				</tr>			<?php } ?>		</tbody>			</table>		<?php echo $this->Paginator->numbers(); ?></div><!-- Filtros --><div class="modal fade" id="filtros-container" tabindex="-1" role="dialog" aria-labelledby="filtros-containerLabel" aria-hidden="true">  <div class="modal-dialog">    <div class="modal-content">      <div class="modal-header">        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Cerrar</span></button>        <h4 class="modal-title" id="filtros-containerLabel">Filtros</h4>      </div>		<div class="modal-body">			<form id="filtros" role="form" class="form-personal" style="padding: 0px;" action="<?php echo $this->here; ?>" method="post">				<?php echo $this->Form->input("EmpresaProducto.activo", array('type'=>'hidden')); ?>				<h3>Datos de la empresa</h3>				<div class="form-group">					<?php echo $this->Form->input("Empresa.nombre_comercial", array('class'=>'botonplano inputplano form-control','label' => 'Nombre comercial')); ?>				</div>				<h3>Datos de la compra</h3>				<div class="form-group" style="overflow: hidden;">					<div class="col-md-6">						<?php echo $this->Form->input('EmpresaProducto.created >=',array('label'=>'Fecha desde','class'=>'fecha-selector inputplano botonplano filtro')); ?>					</div>					<div class="col-md-6">						<?php echo $this->Form->input('EmpresaProducto.created <=',array('label'=>'Fecha hasta','class'=>'fecha-selector inputplano botonplano filtro')); ?>					</div>				</div>			</form>		</div>		<div class="modal-footer">			<button type="button" class="btn btn-default" onClick="LimpiarFiltros();">Limpiar filtros</button>			<button type="button" class="btn btn-primary" onClick="Filtrar();">Filtrar</button>		</div>    </div>  </div></div><!-- Nueva compra --><div class="modal fade" id="nuevac-container" tabindex="-1" role="dialog" aria-labelledby="nuevac-containerLabel" aria-hidden="true">  <div class="modal-dialog">    <div class="modal-content">      <div class="modal-header">        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Cerrar</span></button>        <h4 class="modal-title" id="nuevac-containerLabel">Nueva compra</h4>      </div>		<div class="modal-body">			<form id="nuevac" role="form" class="form-personal" style="padding: 0px;">				<div class="form-group">					<?php echo $this->Form->input("", array('class'=>'botonplano inputplano form-control','label'=>'Empresa','options'=>$empresas,'id'=>'nuevac-empresa','empty'=>'Seleccione','selected'=>(isset($empresa_id)?$empresa_id:''))); ?>					<br><?php echo $this->Form->input("", array('class'=>'botonplano inputplano form-control','label'=>'Producto','options'=>$productos,'id'=>'nuevac-producto','empty'=>'Seleccione')); ?>					<br><?php //echo $this->Form->input("", array('class'=>'botonplano inputplano form-control','label'=>'Precio','id'=>'nuevac-precio')); ?>					<label>Precio</label>					<div class="input-group">						<span class="input-group-addon">MX$</span>						<input style="margin-left: -4px;" id="nuevac-importe" type="text" class="precio botonplano inputplano form-control"/>					</div>				</div>			</form>		</div>		<div class="modal-footer">			<button type="button" class="btn btn-default" onClick="RegisterNewCompra();">Registrar</button>		</div>    </div>  </div></div>