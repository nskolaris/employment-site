<script>var productos = JSON.parse('<?php echo json_encode(Set::combine($productos, '{n}.Producto.id', '{n}')); ?>');var id_producto_open;$(document).ready(function(){	/* Tooltips */	$('.acciones a').tooltip();		$('#producto-edit .categoria_id').change(function(){		ChangeCategoria($(this).val());	});});function Edit(id){	id_producto_open = id;	$.each(productos[id],function(model, values){		$.each(values,function(index, value){			$('#producto-edit [name="'+model+'.'+index+'"]').val(value);		});	});	ChangeCategoria(productos[id].Producto.prod_categoria_id);	$('#edit-container').modal('show');}function ChangeCategoria(value){	$('#producto-edit .cantidad').closest('.input').hide();	if(value == 1){		$('#producto-edit .cantidad.dias').closest('.input').show();	}else{		$('#producto-edit .cantidad.avisos').closest('.input').show();	}}function Save(){	var form = $('#producto-edit');	if(form.find('.denominacion').val()!='' && form.find('.precio').val()!='' && (form.find('.cantidad.dias').val()!='' || form.find('.cantidad.avisos').val()!='')){		var data = {			Producto: {				id: id_producto_open,				denominacion: form.find('.denominacion').val(),				prod_categoria_id: form.find('.categoria_id').val()			},			Configuracion: {				id: productos[id_producto_open].Configuracion.id,				cantidad: form.find('.cantidad.avisos').val(),				dias_vigencia: form.find('.cantidad.dias').val(),				importe: form.find('.precio').val()			}		};		$.post('<?php echo $this->Html->Url(array('controller'=>'productos','action'=>'edit')); ?>', data, function(response){			if(response == 'ok'){location.reload();}		});	}}</script><div class="col-md-12">	<h1>Productos</h1>		<table class="table table-hover">			<thead>			<tr>				<th>ID</th>				<th>Denominación</th>				<th>Categoría</th>				<th>Cantidad</th>				<th>Precio</th>				<th>Acciones</th>			</tr>		</thead>				<tbody>			<?php foreach($productos as $producto){ ?>				<tr>					<td><?php echo $producto['Producto']['id']; ?></td>					<td><?php echo $producto['Producto']['denominacion']; ?></td>					<td><?php echo $producto['Categoria']['denominacion']; ?></td>					<td><?php echo (!empty($producto['Configuracion']['cantidad'])?$producto['Configuracion']['cantidad'].' avisos'.(!empty($producto['Configuracion']['dias_vigencia'])?' por '.$producto['Configuracion']['dias_vigencia'].' dias':''):$producto['Configuracion']['dias_vigencia'].' dias'); ?></td>					<td>MX$ <?php echo $producto['Configuracion']['importe']; ?></td>					<td class="acciones">						<?php echo $this->Html->link('','javascript:void(0);',array('onClick'=>'Edit('.$producto['Producto']['id'].');','class'=>'glyphicon glyphicon-pencil','data-toggle'=>'tooltip','data-placement'=>'bottom','title'=>'Editar')); ?>					</td>				</tr>			<?php } ?>		</tbody>			</table></div><div class="modal fade" id="edit-container" tabindex="-1" role="dialog" aria-labelledby="edit-containerLabel" aria-hidden="true">	<div class="modal-dialog">		<div class="modal-content">			<div class="modal-header">				<button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Cerrar</span></button>				<h4 class="modal-title" id="edit-containerLabel">Editar Producto</h4>			</div>			<div class="modal-body">				<form id="producto-edit" role="form" class="form-personal" style="padding: 0px;">					<div class="form-group">						<?php echo $this->Form->input("", array('name'=>'Producto.denominacion','class'=>'denominacion botonplano inputplano form-control','label' => 'Denominacion')); ?>						<?php echo $this->Form->input("", array('name'=>'Producto.prod_categoria_id','class'=>'categoria_id botonplano inputplano form-control','label' => 'Categoría', 'options' => $categorias)); ?>						<?php echo $this->Form->input("", array('name'=>'Configuracion.cantidad','class'=>'cantidad avisos botonplano inputplano form-control','label' => 'Cantidad de avisos')); ?>						<?php echo $this->Form->input("", array('name'=>'Configuracion.dias_vigencia','class'=>'cantidad dias botonplano inputplano form-control','label' => 'Dias de vigencia')); ?>						<label>Precio</label>						<div class="input-group">							<span class="input-group-addon">MX$</span>							<input style="margin-left: -4px;" name="Configuracion.importe" type="text" class="precio botonplano inputplano form-control"/>						</div>					</div>				</form>			</div>			<div class="modal-footer">				<button type="button" class="btn btn-primary" onClick="Save();">Guardar</button>			</div>		</div>	</div></div>